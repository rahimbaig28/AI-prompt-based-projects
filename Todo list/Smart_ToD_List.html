<!-- Prompt::
 
Build a SINGLE-FILE app in one HTML document (inline CSS +
inline JS, no external libraries) called “Smart To-Do”.
Requirements:
- Add tasks with title, optional description, due date, and
tags (comma-separated).
- Filter by tag and search by text; show counts (All,
Active, Done).
- Drag-and-drop to reorder; click to mark done/undo.
- Persist all data in localStorage. Include “Export/Import
JSON”.
- Responsive layout, accessible (labels, keyboard focus), and
clean minimalist styling.
- Comment the code well and keep everything in one HTML file
only.
-->

<!-- Features::
 
Comprehensive Task Creation: Add tasks with a title, an optional description, a due date, and multiple comma-separated tags.

Powerful Filtering & Search:

Instantly search tasks by title or description.

Filter your list by any tag.

View tasks by status: All, Active, or Done, with live counts for each category.

Intuitive Task Management:

Drag-and-drop to reorder and prioritize your tasks.

Double-click any task to quickly mark it as complete or undo.

Single-click a task to open the edit modal and update its details.

Persistent Local Storage: All your tasks are automatically saved to your browser's localStorage, 
so your to-do list is always waiting for you when you return.

Data Portability:

Export your entire to-do list to a JSON file for backup.

Import tasks from a JSON file to easily restore your data or move it between devices.

Modern & Accessible UI:

Clean, minimalist design that is fully responsive for both desktop and mobile use.

Built with accessibility in mind, featuring proper labels and keyboard focus states.

Zero Dependencies: The entire application is self-contained in a single HTML file. No internet connection, 
build steps, or external libraries are required.-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart To-Do</title>

    <style>
        :root {
            --bg-color: #f9f9f9;
            --fg-color: #ffffff;
            --text-color: #222222;
            --text-light: #666666;
            --border-color: #eeeeee;
            --primary-color: #007aff;
            --primary-hover: #0056b3;
            --done-color: #28a745;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 16px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 1.5rem;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header and Controls */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }
        header h1 { margin: 0; }

        .controls {
            display: flex;
            gap: 1rem;
            background-color: var(--fg-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        .controls > * { flex: 1 1 150px; }

        /* Form Elements */
        input, select, button {
            font-family: inherit;
            font-size: 1rem;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            transition: box-shadow 0.2s;
        }
        input:focus-visible, select:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px var(--primary-color);
        }
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        .btn:hover { background-color: var(--primary-hover); }

        .status-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .status-filters button {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
        }
        .status-filters button.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        /* Task List */
        #task-list { list-style: none; padding: 0; margin: 0; }
        .task-item {
            display: flex;
            align-items: center;
            background-color: var(--fg-color);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            cursor: grab;
            transition: opacity 0.2s, background-color 0.2s;
        }
        .task-item.done { text-decoration: line-through; color: var(--text-light); }
        .task-item.done .task-title { font-weight: normal; }
        .task-item.dragging { opacity: 0.5; background-color: #eef6ff; }
        .task-item:last-child { margin-bottom: 0; }
        .task-item:hover { background-color: #fafafa; }

        .task-content {
            flex-grow: 1;
            cursor: pointer;
        }
        .task-title { font-weight: 600; }
        .task-details {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }
        .task-description {
            font-style: italic;
            display: block;
        }
        .task-tags { margin-left: 0.5rem; }
        .tag {
            background-color: var(--border-color);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .due-date { font-weight: 500; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: var(--fg-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
        }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group textarea {
            width: 100%; box-sizing: border-box;
        }
        .modal-actions {
            display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1.5rem;
        }

        /* Data Management */
        footer {
            margin-top: 2rem;
            padding: 1rem;
            text-align: center;
            color: var(--text-light);
        }
        .data-actions button {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        .data-actions button:hover {
             background-color: var(--border-color);
        }

        /* Responsive */
        @media (max-width: 600px) {
            body { padding: 1rem; }
            .controls { flex-direction: column; }
            .task-item { flex-direction: column; align-items: flex-start; gap: 0.5rem;}
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Smart To-Do</h1>
            <button class="btn" id="add-task-btn">Add New Task</button>
        </header>

        <main>
            <div class="controls">
                <input type="search" id="search-input" placeholder="Search tasks...">
                <select id="tag-filter">
                    <option value="">Filter by tag...</option>
                </select>
            </div>

            <div class="status-filters" id="status-filters">
                <button data-filter="all" class="active">All <span id="count-all"></span></button>
                <button data-filter="active">Active <span id="count-active"></span></button>
                <button data-filter="done">Done <span id="count-done"></span></button>
            </div>

            <ul id="task-list">
                </ul>
        </main>

        <footer>
            <div class="data-actions">
                <button class="btn" id="export-btn">Export to JSON</button>
                <button class="btn" id="import-btn">Import from JSON</button>
                <input type="file" id="import-file" accept=".json" hidden>
            </div>
        </footer>
    </div>

    <div id="task-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">New Task</h2>
            <form id="task-form">
                <input type="hidden" id="task-id">
                <div class="form-group">
                    <label for="task-title">Title</label>
                    <input type="text" id="task-title" required>
                </div>
                <div class="form-group">
                    <label for="task-description">Description (Optional)</label>
                    <textarea id="task-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="task-due-date">Due Date (Optional)</label>
                    <input type="date" id="task-due-date">
                </div>
                <div class="form-group">
                    <label for="task-tags">Tags (comma-separated)</label>
                    <input type="text" id="task-tags" placeholder="e.g., work, urgent">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn" id="delete-btn" style="background-color: #dc3545; display: none;">Delete</button>
                    <button type="button" class="btn" id="cancel-btn" style="background: none; color: var(--text-color); border: 1px solid var(--border-color);">Cancel</button>
                    <button type="submit" class="btn">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM ELEMENT REFERENCES ---
            const taskList = document.getElementById('task-list');
            const addTaskBtn = document.getElementById('add-task-btn');
            const taskModal = document.getElementById('task-modal');
            const taskForm = document.getElementById('task-form');
            const cancelBtn = document.getElementById('cancel-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const searchInput = document.getElementById('search-input');
            const tagFilter = document.getElementById('tag-filter');
            const statusFilters = document.getElementById('status-filters');
            const exportBtn = document.getElementById('export-btn');
            const importBtn = document.getElementById('import-btn');
            const importFile = document.getElementById('import-file');
            
            // --- STATE MANAGEMENT ---
            let tasks = [];
            let currentFilters = { search: '', tag: '', status: 'all' };
            const DB_NAME = 'smartToDoDB';

            // --- DATA PERSISTENCE ---
            const loadTasks = () => {
                const data = localStorage.getItem(DB_NAME);
                tasks = data ? JSON.parse(data) : [];
            };

            const saveTasks = () => {
                localStorage.setItem(DB_NAME, JSON.stringify(tasks));
            };

            // --- CORE LOGIC: RENDERING & FILTERING ---

            /**
             * Renders all tasks to the DOM based on current filters.
             * This is the main function that updates the UI.
             */
            const render = () => {
                // Filter tasks
                const filteredTasks = tasks.filter(task => {
                    const searchMatch = task.title.toLowerCase().includes(currentFilters.search) ||
                                      task.description.toLowerCase().includes(currentFilters.search);
                    const tagMatch = !currentFilters.tag || task.tags.includes(currentFilters.tag);
                    const statusMatch = currentFilters.status === 'all' ||
                                        (currentFilters.status === 'done' && task.done) ||
                                        (currentFilters.status === 'active' && !task.done);
                    return searchMatch && tagMatch && statusMatch;
                });

                // Clear current list
                taskList.innerHTML = '';
                
                // Re-populate list
                filteredTasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = `task-item ${task.done ? 'done' : ''}`;
                    li.setAttribute('data-id', task.id);
                    li.setAttribute('draggable', 'true');
                    
                    const tagsHTML = task.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ');
                    
                    li.innerHTML = `
                        <div class="task-content">
                            <span class="task-title">${task.title}</span>
                            <div class="task-details">
                                ${task.description ? `<span class="task-description">${task.description}</span>` : ''}
                                ${task.dueDate ? `<span class="due-date">Due: ${task.dueDate}</span>` : ''}
                                <span class="task-tags">${tagsHTML}</span>
                            </div>
                        </div>
                    `;
                    taskList.appendChild(li);
                });

                updateCounts();
                updateTagFilter();
            };
            
            /**
             * Updates the task counts (All, Active, Done).
             */
            const updateCounts = () => {
                document.getElementById('count-all').textContent = `(${tasks.length})`;
                document.getElementById('count-active').textContent = `(${tasks.filter(t => !t.done).length})`;
                document.getElementById('count-done').textContent = `(${tasks.filter(t => t.done).length})`;
            };

            /**
             * Populates the tag filter dropdown with unique tags from all tasks.
             */
            const updateTagFilter = () => {
                const allTags = new Set(tasks.flatMap(t => t.tags));
                tagFilter.innerHTML = '<option value="">Filter by tag...</option>';
                allTags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag;
                    option.textContent = tag;
                    tagFilter.appendChild(option);
                });
                tagFilter.value = currentFilters.tag;
            };

            // --- MODAL HANDLING ---
            const openModal = (task = null) => {
                taskForm.reset();
                if (task) {
                    // Editing existing task
                    document.getElementById('modal-title').textContent = 'Edit Task';
                    document.getElementById('task-id').value = task.id;
                    document.getElementById('task-title').value = task.title;
                    document.getElementById('task-description').value = task.description;
                    document.getElementById('task-due-date').value = task.dueDate;
                    document.getElementById('task-tags').value = task.tags.join(', ');
                    deleteBtn.style.display = 'inline-block';
                } else {
                    // Adding new task
                    document.getElementById('modal-title').textContent = 'New Task';
                    document.getElementById('task-id').value = '';
                    deleteBtn.style.display = 'none';
                }
                taskModal.style.display = 'flex';
                document.getElementById('task-title').focus();
            };

            const closeModal = () => {
                taskModal.style.display = 'none';
            };

            // --- EVENT LISTENERS ---
            
            // Open modal to add a task
            addTaskBtn.addEventListener('click', () => openModal());

            // Close modal actions
            cancelBtn.addEventListener('click', closeModal);
            taskModal.addEventListener('click', (e) => {
                if (e.target === taskModal) closeModal();
            });

            // Save or update a task
            taskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = document.getElementById('task-id').value;
                const tags = document.getElementById('task-tags').value.split(',')
                    .map(tag => tag.trim()).filter(Boolean);

                const taskData = {
                    id: id ? Number(id) : Date.now(),
                    title: document.getElementById('task-title').value,
                    description: document.getElementById('task-description').value,
                    dueDate: document.getElementById('task-due-date').value,
                    tags: tags,
                    done: id ? tasks.find(t => t.id === Number(id)).done : false
                };

                if (id) {
                    tasks = tasks.map(t => t.id === Number(id) ? taskData : t);
                } else {
                    tasks.push(taskData);
                }
                saveTasks();
                render();
                closeModal();
            });

            // Delete a task
            deleteBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this task?')) {
                    const id = Number(document.getElementById('task-id').value);
                    tasks = tasks.filter(t => t.id !== id);
                    saveTasks();
                    render();
                    closeModal();
                }
            });
            
            // Handle clicks on task list for toggling done or editing
            taskList.addEventListener('click', (e) => {
                const taskItem = e.target.closest('.task-item');
                if (!taskItem) return;
                const id = Number(taskItem.dataset.id);
                
                // Check if the click was on the main content area
                if (e.target.closest('.task-content')) {
                    const task = tasks.find(t => t.id === id);
                    if (task) {
                        openModal(task);
                    }
                }
            });

            // Double click to mark as done/undone
            taskList.addEventListener('dblclick', (e) => {
                 const taskItem = e.target.closest('.task-item');
                 if (!taskItem) return;
                 const id = Number(taskItem.dataset.id);
                 const task = tasks.find(t => t.id === id);
                 if(task) {
                    task.done = !task.done;
                    saveTasks();
                    render();
                 }
            });

            // Filter listeners
            searchInput.addEventListener('input', (e) => {
                currentFilters.search = e.target.value.toLowerCase();
                render();
            });

            tagFilter.addEventListener('change', (e) => {
                currentFilters.tag = e.target.value;
                render();
            });
            
            statusFilters.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    currentFilters.status = e.target.dataset.filter;
                    document.querySelector('.status-filters button.active').classList.remove('active');
                    e.target.classList.add('active');
                    render();
                }
            });

            // Drag and Drop functionality
            let draggedItemId = null;
            taskList.addEventListener('dragstart', (e) => {
                const taskItem = e.target.closest('.task-item');
                if (taskItem) {
                    draggedItemId = Number(taskItem.dataset.id);
                    e.dataTransfer.effectAllowed = 'move';
                    // Use a timeout to allow the browser to paint the drag image
                    setTimeout(() => taskItem.classList.add('dragging'), 0);
                }
            });
            
            taskList.addEventListener('dragend', (e) => {
                const taskItem = e.target.closest('.task-item');
                if (taskItem) taskItem.classList.remove('dragging');
            });

            taskList.addEventListener('dragover', (e) => {
                e.preventDefault(); // Necessary to allow dropping
            });
            
            taskList.addEventListener('drop', (e) => {
                e.preventDefault();
                const targetItem = e.target.closest('.task-item');
                if (!targetItem || Number(targetItem.dataset.id) === draggedItemId) {
                    return;
                }
                const draggedIndex = tasks.findIndex(t => t.id === draggedItemId);
                const targetIndex = tasks.findIndex(t => t.id === Number(targetItem.dataset.id));

                // Remove the dragged task and re-insert it at the target position
                const [draggedTask] = tasks.splice(draggedIndex, 1);
                tasks.splice(targetIndex, 0, draggedTask);

                saveTasks();
                render();
            });

            // Data export/import
            exportBtn.addEventListener('click', () => {
                const dataStr = JSON.stringify(tasks, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.download = 'smart-todo-backup.json';
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
            });

            importBtn.addEventListener('click', () => importFile.click());
            
            importFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!confirm('Importing a file will overwrite all current tasks. Are you sure?')) {
                    importFile.value = ''; // Reset file input
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedTasks = JSON.parse(event.target.result);
                        // Basic validation
                        if (Array.isArray(importedTasks)) {
                            tasks = importedTasks;
                            saveTasks();
                            render();
                        } else {
                            alert('Invalid JSON file format.');
                        }
                    } catch (error) {
                        alert('Error reading or parsing JSON file.');
                    } finally {
                        importFile.value = ''; // Reset for next import
                    }
                };
                reader.readAsText(file);
            });

            // --- INITIALIZATION ---
            loadTasks();
            render();
        });
    </script>
</body>
</html>